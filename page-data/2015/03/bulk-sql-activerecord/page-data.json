{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/2015/03/bulk-sql-activerecord/","result":{"data":{"site":{"siteMetadata":{"repsitory":"https://github.com/tmr08c/tmr08c.github.io"}},"markdownRemark":{"id":"f96b605e-7929-51b7-bc5a-28ca987123d4","excerpt":"New Rails developers tend to fall in love with ActiveRecord. More specifically they fall in love with the \"magic\" of ActiveRecord - the ability to use simpleâ€¦","html":"<p>New Rails developers tend to fall in love with ActiveRecord. More specifically they fall in love with the \"magic\" of ActiveRecord - the ability to use simple methods to represent some unknown SQL. The problem is, they don't worry about what ActiveRecord is doing under the covers and what the resulting queries actually look like. This can lead to slow methods that require a large amount of memory.</p>\n<p>One instance where you may see this is in deleting large sets of data.</p>\n<p>Let's say we have an online bookstore with a <code>Book</code> model that looks something like this:</p>\n<pre class=\"grvsc-container tomorrow grvsc-ps-tJmpaV\" data-language=\"ruby\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-3 grvsc-tJmpaV-3\"># == Schema Information</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-3 grvsc-tJmpaV-3\">#</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-3 grvsc-tJmpaV-3\"># Table name: books</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-3 grvsc-tJmpaV-3\">#</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-3 grvsc-tJmpaV-3\">#  id         :integer          not null, primary key</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-3 grvsc-tJmpaV-3\">#  title      :string(255)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-3 grvsc-tJmpaV-3\">#  isbn       :string(255)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-3 grvsc-tJmpaV-3\">#  author     :string(255)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-3 grvsc-tJmpaV-3\">#  quantity   :integer</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-3 grvsc-tJmpaV-3\">#  created_at :datetime</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-3 grvsc-tJmpaV-3\">#  updated_at :datetime</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-3 grvsc-tJmpaV-3\">#</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">class</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-9 grvsc-tJmpaV-9\">Book</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">&lt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">ActiveRecord::Base</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">end</span></span></span></code></pre>\n<p>We also have an <code>OrderGenerator</code> class that uses the <code>quantity</code> field to find books we need to re-order from the distributor:</p>\n<pre class=\"grvsc-container tomorrow grvsc-ps-tJmpaV\" data-language=\"ruby\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">class</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-9 grvsc-tJmpaV-9\">OrderGenerator</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">def</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-10 grvsc-tJmpaV-10\">self.book_list</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-9 grvsc-tJmpaV-9\">Book</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.where(</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;quantity &lt; 20&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">).pluck(</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">:isbn</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">end</span></span></span></code></pre>\n<p>The problem is, there are books that go out of print and are no longer available for reorder. Our current system does not account for this case and our distributor is getting annoyed that we keep requesting the same out of print books on every order.</p>\n<p>We decide to create a cron job that will run regularly to remove any <code>Book</code> records that have a <code>quantity</code> of zero and have not been restocked in the last month.</p>\n<p>We code up an initial solution that looks something like</p>\n<pre class=\"grvsc-container tomorrow grvsc-ps-tJmpaV\" data-language=\"ruby\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">class</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-9 grvsc-tJmpaV-9\">Book</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">def</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-10 grvsc-tJmpaV-10\">self.remove_with_destroy</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    books </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> where(</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">quantity:</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">0</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">).where(</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;updated_at &lt; &#39;</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">#{</span><span class=\"grvsc-t564vY-9 grvsc-tJmpaV-9\">Time</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">.now </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">-</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\"> </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">1</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">.month</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">}</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&#39;&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    books.each </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">do</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> |</span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">book</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">      book.destroy</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">end</span></span></span></code></pre>\n<p>This solution will do what we need but, while simple enough, there are a few issues we should be concerned with.</p>\n<h2 id=\"setting-up-the-tests\" style=\"position:relative;\"><a href=\"#setting-up-the-tests\" aria-label=\"setting up the tests permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setting Up The Tests</h2>\n<p>Before I begin I want to discuss how I set up the environment for the benchmarks to come.</p>\n<p>Inspired by a great tips in Justin Weiss' book, <a href=\"https://www.justinweiss.com/practicing-rails/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><em>Practicing Rails</em></a>, I decided that in order to test this properly I should make an actual Rails application based on my example.</p>\n<p>Since I work with large, established Rails applications on a daily basis, I tend to forget how easy it is to create a simple, new project for testing a few things out. Between <code>rails new</code>, <code>rails g scaffold</code>, and <code>rake db:seed</code> my testing environment was up in a matter of minutes.</p>\n<h3 id=\"creating-a-large-number-of-records\" style=\"position:relative;\"><a href=\"#creating-a-large-number-of-records\" aria-label=\"creating a large number of records permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Creating a large number of Records</h3>\n<p>To emulate having hundreds of thousands of books I used the <code>seed.rb</code> file to create 300,000 <code>Book</code> records</p>\n<pre class=\"grvsc-container tomorrow grvsc-ps-tJmpaV\" data-language=\"ruby\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-3 grvsc-tJmpaV-3\"># db/seeds.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">(</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">1</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">..</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">300_000</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">).each </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">do</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> |</span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">i</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-9 grvsc-tJmpaV-9\">Book</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.create(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">author:</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;Author </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">#{</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">i</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">}</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">title:</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;Book </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">#{</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">i</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">}</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">isbn:</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">#{</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">i</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">}</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">quantity:</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> i </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">%</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">end</span></span></span></code></pre>\n<p>The logic to set the <code>quantity</code> field checks if the current index is divisible by 2. This results in half of the books having a quantity of 0 (and the other half 1).</p>\n<p>Since I was creating everything at the time of testing I would need to change the <code>updated_at</code> field to be older than one month ago to represent the idea we have not been able to restock these book for a long time.</p>\n<pre class=\"grvsc-container tomorrow grvsc-ps-tJmpaV\" data-language=\"ruby\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-9 grvsc-tJmpaV-9\">Book</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.where(</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">quantity:</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">0</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">).limit(</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">50_000</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">).update_all(</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">updated_at:</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-9 grvsc-tJmpaV-9\">Time</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.now </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">-</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">2</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.months)</span></span></span></code></pre>\n<p>I chose to update 50,000 records. I felt updating all books with a quantity of 0 breaks the idea that we only want to remove a subset of our out of stock products. I also thought 50,000 records were enough where we should see substantial run times.</p>\n<p>I added this to my seeds file as well so I could easily reproduce the entire setup between benchmarks.</p>\n<p>Now that I have an environment where I can easily and reliably create a large number of records I can write the method I want to test, seed the database, and benchmark the runtime for each solution.</p>\n<h2 id=\"destroy-vs-delete\" style=\"position:relative;\"><a href=\"#destroy-vs-delete\" aria-label=\"destroy vs delete permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>destroy vs. delete</h2>\n<p>As shown before, our current solution is to loop through each book and use the <code>destroy</code> method:</p>\n<pre class=\"grvsc-container tomorrow grvsc-ps-tJmpaV\" data-language=\"ruby\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">class</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-9 grvsc-tJmpaV-9\">Book</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">def</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-10 grvsc-tJmpaV-10\">self.remove_with_destroy</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    books </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> where(</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">quantity:</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">0</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">).where(</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;updated_at &lt; </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">#{</span><span class=\"grvsc-t564vY-9 grvsc-tJmpaV-9\">Time</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">.now </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">-</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\"> </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">1</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">.month</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">}</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    books.each </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">do</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> |</span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">book</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">      book.destroy</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">end</span></span></span></code></pre>\n<h3 id=\"destroy\" style=\"position:relative;\"><a href=\"#destroy\" aria-label=\"destroy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>destroy</h3>\n<p>The <a href=\"http://api.rubyonrails.org/classes/ActiveRecord/Relation.html#method-i-destroy\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code>destroy</code></a> method will instantiate an instance of the <code>ActiveRecord::Model</code> (the <code>Book</code> in this case) in order to allow callbacks to be handled.</p>\n<p>The ability to make sure callbacks are fired off when deleting an object can be very useful, especially when dealing with deleting associations or handling any custom <code>before_destroy</code> callbacks. However, in our case, we have no assoications or callbacks to be concerned with so this ends up being unncessary overhead.</p>\n<p>Another issue with this method is that we end up running separate queries for each deletion. This problem is where the inspiraton for this post came from. While it is hard to know that <code>destroy</code> will run callbacks on you objects without looking into the documentation, we can easily watch our logs when running methods to see what qeuries are being made.</p>\n<p>This is a tiny subset of the output:</p>\n<pre class=\"grvsc-container tomorrow grvsc-ps-tJmpaV\" data-language=\"sql\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">SQL</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> (</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">0</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.2ms)  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">DELETE</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">FROM</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;books&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">WHERE</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;books&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;id&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> ?  [[&quot;id&quot;, 1000593]]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">(</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">0</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.5ms)  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">commit</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">transaction</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">(</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">0</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.0ms)  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">begin</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">transaction</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">SQL</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> (</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">0</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.2ms)  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">DELETE</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">FROM</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;books&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">WHERE</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;books&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;id&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> ?  [[&quot;id&quot;, 1000595]]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">(</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">0</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.5ms)  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">commit</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">transaction</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">(</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">0</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.0ms)  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">begin</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">transaction</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">SQL</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> (</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">0</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.2ms)  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">DELETE</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">FROM</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;books&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">WHERE</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;books&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;id&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> ?  [[&quot;id&quot;, 1000598]]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">(</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">0</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.5ms)  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">commit</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">transaction</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">(</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">0</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.0ms)  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">begin</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">transaction</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">SQL</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> (</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">0</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.2ms)  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">DELETE</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">FROM</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;books&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">WHERE</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;books&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;id&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> ?  [[&quot;id&quot;, 1000599]]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">(</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">0</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.5ms)  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">commit</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">transaction</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">(</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">0</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.0ms)  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">begin</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">transaction</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">SQL</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> (</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">0</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.2ms)  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">DELETE</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">FROM</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;books&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">WHERE</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;books&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;id&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> ?  [[&quot;id&quot;, 1000605]]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">(</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">0</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.6ms)  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">commit</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">transaction</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">(</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">0</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.0ms)  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">begin</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">transaction</span></span></span></code></pre>\n<p>For each of the 50,000 records we are deleting, we will create a transaction and execute a delete query. While each step is quick, most less than half a millisecond, this will add up when dealing with 50,000 records. We can see the results of a benchmark of a full run below, the total time was almost 100 seconds.</p>\n<pre class=\"grvsc-container tomorrow grvsc-ps-tJmpaV\" data-language=\"\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">                          user     system      total        real</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">remove_with_destroy   20.090000  21.970000  42.060000 ( 96.173008)</span></span></code></pre>\n<h3 id=\"delete\" style=\"position:relative;\"><a href=\"#delete\" aria-label=\"delete permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>delete</h3>\n<p>As mentioned before, <code>destroy</code> will instantiate an instace of the object about to be deleted in order to run any callbacks. In our case, we are not worried about deleting associated models and we do not have any callbacks, so instantiating an object and running the callbacks ends up requiring more time and memory than necessary.</p>\n<p>The documentation for <a href=\"http://api.rubyonrails.org/classes/ActiveRecord/Relation.html#method-i-destroy\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code>destroy</code></a> actually addresses this concern <strong>and</strong> suggests an alternative, using the <a href=\"http://api.rubyonrails.org/classes/ActiveRecord/Relation.html#method-i-delete\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code>delete</code></a> method:</p>\n<blockquote>\n<p>The object is instantiated first, therefore all callbacks and filters are fired off before the object is deleted. This method is less efficient than ActiveRecord#delete but allows cleanup methods and other actions to be run.</p>\n</blockquote>\n<p>The delete method no longer instantiates an instance of the <code>Book</code> class but rather simply sends a <code>DELETE</code> query for the record in question.</p>\n<p>To make this change we simply replace our use of <code>destroy</code> with <code>delete</code></p>\n<pre class=\"grvsc-container tomorrow grvsc-ps-tJmpaV\" data-language=\"ruby\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">class</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-9 grvsc-tJmpaV-9\">Book</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">def</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-10 grvsc-tJmpaV-10\">self.remove_with_delete</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    books </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> where(</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">quantity:</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">0</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">).where(</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;updated_at &lt; </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">#{</span><span class=\"grvsc-t564vY-9 grvsc-tJmpaV-9\">Time</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">.now </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">-</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\"> </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">1</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">.month</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">}</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    books.each </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">do</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> |</span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">book</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">      book.delete</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">end</span></span></span></code></pre>\n<p>When we run the benchmarks now we see a significant improvement</p>\n<pre class=\"grvsc-container tomorrow grvsc-ps-tJmpaV\" data-language=\"\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">user                      system      total        real</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">remove_with_destroy    12.960000  21.140000  34.100000 ( 49.324933)</span></span></code></pre>\n<p>If we keep an eye on the logs as our method runs we will again see what should be a red flag - we still end up with a query for each record we are deleting.</p>\n<pre class=\"grvsc-container tomorrow grvsc-ps-tJmpaV\" data-language=\"sql\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">SQL</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> (</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">0</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.5ms)  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">DELETE</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">FROM</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;books&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">WHERE</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;books&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;id&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">1900739</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">SQL</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> (</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">0</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.6ms)  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">DELETE</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">FROM</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;books&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">WHERE</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;books&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;id&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">1900740</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">SQL</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> (</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">0</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.5ms)  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">DELETE</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">FROM</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;books&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">WHERE</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;books&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;id&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">1900742</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">SQL</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> (</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">0</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.6ms)  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">DELETE</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">FROM</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;books&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">WHERE</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;books&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;id&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">1900746</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">SQL</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> (</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">0</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.8ms)  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">DELETE</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">FROM</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;books&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">WHERE</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;books&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;id&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">1900748</span></span></span></code></pre>\n<h2 id=\"delete_all\" style=\"position:relative;\"><a href=\"#delete_all\" aria-label=\"delete_all permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>delete_all</h2>\n<p>Luckily there is a solution that will stop us from having to instantiate any objects <strong>and</strong> will handle all of the deletion in a single query. That solution is <a href=\"http://api.rubyonrails.org/classes/ActiveRecord/Relation.html#method-i-delete_all\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code>delete_all</code></a>.</p>\n<pre class=\"grvsc-container tomorrow grvsc-ps-tJmpaV\" data-language=\"ruby\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">class</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-9 grvsc-tJmpaV-9\">Book</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">def</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-10 grvsc-tJmpaV-10\">self.remove_with_delete_all</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    where(</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">quantity:</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">0</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">).where(</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;updated_at &lt; &#39;</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">#{</span><span class=\"grvsc-t564vY-9 grvsc-tJmpaV-9\">Time</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">.now </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">-</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\"> </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">1</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">.month</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">}</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&#39;&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">).delete_all</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">end</span></span></span></code></pre>\n<p>As promised, this deletes everything in a single query</p>\n<pre class=\"grvsc-container tomorrow grvsc-ps-tJmpaV\" data-language=\"sql\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">SQL</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> (</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">152</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.4ms)  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">DELETE</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">FROM</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;books&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">WHERE</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;books&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;quantity&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">0</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">AND</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> (updated_at </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">&lt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&#39;2015-03-04 12:30:09 -0500&#39;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">)</span></span></span></code></pre>\n<p>The execution time of the query is 152.4ms or 0.1524 seconds. If we look at the results of our benchmark</p>\n<pre class=\"grvsc-container tomorrow grvsc-ps-tJmpaV\" data-language=\"\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">user     system      total        real</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">remove_with_delete_all   0.060000   0.040000   0.100000 (  0.154572)</span></span></code></pre>\n<p>we noticethat the total exectuion time is only miliseconds more than the query took. This is because there was no additional overhead of creating objects, running callbacks or dealing with associations.</p>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>In conclusion, if you are not worried about callbacks or managing associations <code>delete_all</code> will result in speedy deletion of large datasets.</p>\n<pre class=\"grvsc-container tomorrow grvsc-ps-tJmpaV\" data-language=\"\" data-index=\"14\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">                            user     system      total        real</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">remove_with_destroy     20.090000  21.970000  42.060000 ( 96.173008)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">remove_with_destroy     12.960000  21.140000  34.100000 ( 49.324933)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">remove_with_delete_all   0.060000   0.040000   0.100000 (  0.154572)</span></span></code></pre>\n<p>More importantly - keep an eye on what your code is doing. As developers we need to own our code and keep it running smoothly. It is difficult to make sure things are running well when we aren't looking for signs that they aren't. When navigating around your site, keep open your server logs or use tools like <a href=\"http://miniprofiler.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">MiniProfiler</a> or <a href=\"https://github.com/dejan/rails_panel\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">RailsPanel</a> for Chrome. When running methods in the console be sure to run with an active query logger running. Only we can prevent poor performing applications!</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .tomorrow {\n    background-color: #FFFFFF;\n    color: #4D4D4C;\n  }\n  .tomorrow .grvsc-t564vY-3 { color: #8E908C; }\n  .tomorrow .grvsc-t564vY-11 { color: #8959A8; }\n  .tomorrow .grvsc-t564vY-1 { color: #4D4D4C; }\n  .tomorrow .grvsc-t564vY-9 { color: #C99E00; }\n  .tomorrow .grvsc-t564vY-6 { color: #3E999F; }\n  .tomorrow .grvsc-t564vY-7 { color: #718C00; }\n  .tomorrow .grvsc-t564vY-10 { color: #4271AE; }\n  .tomorrow .grvsc-t564vY-4 { color: #F5871F; }\n  .tomorrow .grvsc-t564vY-8 { color: #C82829; }\n  .tomorrow .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(0, 0, 0, 0.05));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(0, 0, 0, 0.2));\n  }\n  body.dark .grvsc-ps-tJmpaV {\n    background-color: #1D1F21;\n    color: #C5C8C6;\n  }\n  body.dark .grvsc-ps-tJmpaV .grvsc-tJmpaV-3 { color: #969896; }\n  body.dark .grvsc-ps-tJmpaV .grvsc-tJmpaV-11 { color: #B294BB; }\n  body.dark .grvsc-ps-tJmpaV .grvsc-tJmpaV-1 { color: #C5C8C6; }\n  body.dark .grvsc-ps-tJmpaV .grvsc-tJmpaV-9 { color: #F0C674; }\n  body.dark .grvsc-ps-tJmpaV .grvsc-tJmpaV-6 { color: #8ABEB7; }\n  body.dark .grvsc-ps-tJmpaV .grvsc-tJmpaV-7 { color: #B5BD68; }\n  body.dark .grvsc-ps-tJmpaV .grvsc-tJmpaV-10 { color: #81A2BE; }\n  body.dark .grvsc-ps-tJmpaV .grvsc-tJmpaV-4 { color: #DE935F; }\n  body.dark .grvsc-ps-tJmpaV .grvsc-tJmpaV-8 { color: #CC6666; }\n  body.dark .grvsc-ps-tJmpaV .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","frontmatter":{"title":"Bulk SQL Statements with ActiveRecord - delete_all","date":"March 28, 2015"}}},"pageContext":{"slug":"/2015/03/bulk-sql-activerecord/","previous":{"fields":{"slug":"/2015/03/anatomy-of-ruby-class/"},"frontmatter":{"title":"The Anatomy of a Ruby Class"}},"next":{"fields":{"slug":"/2015/04/private-class-methods-ruby/"},"frontmatter":{"title":"Are Your Class Methods Actually Private?"}}}},"staticQueryHashes":["3128451518","3649515864"]}