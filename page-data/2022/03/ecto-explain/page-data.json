{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/2022/03/ecto-explain/","result":{"data":{"site":{"siteMetadata":{"repsitory":"https://github.com/tmr08c/tmr08c.github.io"}},"markdownRemark":{"id":"8a1e3178-9604-5669-b667-7321a6cf8ac8","excerpt":"In a previous post, I gave a brief introduction to understanding the results of an EXPLAIN query (from postgres, at least). In this post, I cover generating anâ€¦","html":"<p>In a <a href=\"/2021/09/intro-to-postgres-explain\">previous post</a>, I gave a brief introduction to understanding the results of an <code>EXPLAIN</code> query (from postgres, at least). In this post, I cover generating an <code>EXPLAIN</code>query with <a href=\"https://hexdocs.pm/ecto/Ecto.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Ecto</a>.</p>\n<h2 id=\"explaining\" style=\"position:relative;\"><a href=\"#explaining\" aria-label=\"explaining permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Explaining</h2>\n<p>Fortunately, Ecto provides an explain function, <a href=\"https://hexdocs.pm/ecto_sql/Ecto.Adapters.SQL.html#explain/4\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code>Ecto.Adapters.SQL.explain/4</code></a>.</p>\n<p>The function is provided in the adapters module because not all database management systems support <code>EXPLAIN</code> capabilities. <code>explain/4</code> will leverage a <a href=\"https://hexdocs.pm/ecto_sql/Ecto.Adapters.SQL.Connection.html#c:explain_query/4\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">DBMS-specific adapter for generating the query</a>:</p>\n<blockquote>\n<p>Executes an EXPLAIN statement or similar for the given query according to its kind and the adapter in the given repository.</p>\n</blockquote>\n<p>The first argument to <code>Ecto.Adapters.SQL.explain/4</code> is a <code>Repo</code> module. There is also a convenience function, <code>Repo.explain/3</code> which alleviates the need to pass in the <code>Repo</code>.</p>\n<pre class=\"grvsc-container tomorrow grvsc-ps-tJmpaV\" data-language=\"ex\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">iex()</span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> h </span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Repo</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.explain</span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">/</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">3</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">     </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">def</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-10 grvsc-tJmpaV-10\">explain</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">(operation, queryable, opts </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">\\\\</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> [])</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">A</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> convenience function </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">for</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">SQL</span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">-</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">based repositories that executes</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">an </span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">EXPLAIN</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> statement </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">or</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> similar depending on the adapter to obtain</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">statistics </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">for</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> the given query.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">See</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Ecto</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Adapters</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">SQL</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.explain</span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">/</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">4</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">for</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> more information.</span></span></span></code></pre>\n<h2 id=\"example\" style=\"position:relative;\"><a href=\"#example\" aria-label=\"example permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Example</h2>\n<h3 id=\"set-up\" style=\"position:relative;\"><a href=\"#set-up\" aria-label=\"set up permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Set up</h3>\n<p>To demonstrate, we will create the schemas needed for a blog, <code>Post</code> and <code>Comment</code>, which are in a one-to-many relationship.</p>\n<h4 id=\"post-schema\" style=\"position:relative;\"><a href=\"#post-schema\" aria-label=\"post schema permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Post Schema</h4>\n<pre class=\"grvsc-container tomorrow grvsc-ps-tJmpaV\" data-language=\"ex\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">defmodule</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> SampleBlog.Blog.Post </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-10 grvsc-tJmpaV-10\">use</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Ecto</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Schema</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-10 grvsc-tJmpaV-10\">import</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Ecto</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Changeset</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-10 grvsc-tJmpaV-10\">alias</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">SampleBlog</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Blog</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Comment</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  schema </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;blog_posts&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    field </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">:title</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">, </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">:string</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    has_many </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">:comments</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">, </span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Comment</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    timestamps()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-3 grvsc-tJmpaV-3\">@doc false</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">def</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-10 grvsc-tJmpaV-10\">changeset</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">(post, attrs) </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    post</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">|&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> cast(attrs, [</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">:title</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">, </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">:inserted_at</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">])</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">|&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> validate_required([</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">:title</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">])</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">end</span></span></span></code></pre>\n<h4 id=\"comment-schema\" style=\"position:relative;\"><a href=\"#comment-schema\" aria-label=\"comment schema permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Comment Schema</h4>\n<pre class=\"grvsc-container tomorrow grvsc-ps-tJmpaV\" data-language=\"ex\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">defmodule</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> SampleBlog.Blog.Comment </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-10 grvsc-tJmpaV-10\">use</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Ecto</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Schema</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-10 grvsc-tJmpaV-10\">import</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Ecto</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Changeset</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-10 grvsc-tJmpaV-10\">alias</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">SampleBlog</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Blog</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Post</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  schema </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;blog_comments&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    field </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">:body</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">, </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">:string</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    belongs_to </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">:post</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">, </span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Post</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    timestamps()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-3 grvsc-tJmpaV-3\">@doc false</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">def</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-10 grvsc-tJmpaV-10\">changeset</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">(comments, attrs) </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    comments</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">|&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> cast(attrs, [</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">:body</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">, </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">:post_id</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">])</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">|&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> validate_required([</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">:body</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">, </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">:post_id</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">])</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">end</span></span></span></code></pre>\n<h3 id=\"our-query\" style=\"position:relative;\"><a href=\"#our-query\" aria-label=\"our query permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Our Query</h3>\n<p>The query we want to <code>EXPLAIN</code> will be fetching posts with recent activity. Our query will look something like this:</p>\n<pre class=\"grvsc-container tomorrow grvsc-ps-tJmpaV\" data-language=\"ex\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">def</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-10 grvsc-tJmpaV-10\">posts_with_recent_activity</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">() </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  recent </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;Etc/UTC&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">|&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">DateTime</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.now!()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">|&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">DateTime</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.add(</span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">-</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">60</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">*</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">60</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">*</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">24</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">, </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">:second</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  from(p </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">in</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Post</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">|&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> join(</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">:left</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">, [p], c </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">in</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> assoc(p, </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">:comments</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">|&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> preload([p, c], </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">comments:</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> c)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">|&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> where([p, c], p.inserted_at </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> ^recent </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">or</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">                   c.inserted_at </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> ^recent)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">|&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> order_by([p], </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">desc:</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> p.inserted_at)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">|&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Repo</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.all()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">end</span></span></span></code></pre>\n<p>In this query, we <code>join</code> the <code>posts</code> with their <code>comments</code>. We also filter both tables based on the <code>inserted_at</code> column as our means of finding recent activity. Finally, we order the results by the posts' <code>inserted_at</code> column; this simply adds more details to our <code>EXPLAIN</code> result</p>\n<h3 id=\"explain-versus-ioinspect\" style=\"position:relative;\"><a href=\"#explain-versus-ioinspect\" aria-label=\"explain versus ioinspect permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EXPLAIN versus IO.inspect</h3>\n<p>A common debugging technique used in Elixir is to insert an <code>IO.inspect</code> in-between steps of a pipeline. Unfortunately, this does work for the <code>explain</code> function because it expects to receive a queryable (so it will not work at the end of the pipeline) and returns a string instead of what was passed in (so we break the pipeline or lose our results).</p>\n<p>If we only care about the <code>EXPLAIN</code> results we could remove our call to <code>Repo.all</code> and pass our queryable to the <code>explain</code> function.</p>\n<pre class=\"grvsc-container tomorrow grvsc-ps-tJmpaV\" data-language=\"ex\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">def</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-10 grvsc-tJmpaV-10\">posts_with_recent_activity</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">() </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  recent </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;Etc/UTC&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">|&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">DateTime</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.now!()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">|&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">DateTime</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.add(</span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">-</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">60</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">*</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">60</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">*</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">24</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">, </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">:second</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  queryable </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    from(p </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">in</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Post</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">|&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> join(</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">:left</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">, [p], c </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">in</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> assoc(p, </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">:comments</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">|&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> preload([p, c], </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">comments:</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> c)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">|&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> where([p, c], p.inserted_at </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> ^recent </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">or</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">                     c.inserted_at </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> ^recent)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">|&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> order_by([p], </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">desc:</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> p.inserted_at)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-3 grvsc-tJmpaV-3\"># Note we no longer call Repo.all</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">SampleBlog</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Repo</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">|&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Ecto</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Adapters</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">SQL</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.explain(</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">:all</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">, queryable)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">|&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">IO</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.puts()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">end</span></span></span></code></pre>\n<p>Since the result of <code>explain</code> is a string containing the <code>EXPLAIN</code> results, I recommend <code>IO.puts</code> over <code>IO.inspect</code> because it will print the newlines and better format the result.</p>\n<p>In practice, making this change can be a bit of a pain. By no longer returning the result of your query, you will break the consumers of this function. This breaking strategy works for a quick peek into what the database is doing. However, if you are tuning the query, you may want to run this multiple times. Returning the query results may be preferable in this case as it will allow you to validate the results continue to be correct.</p>\n<h3 id=\"preserving-the-pipeline\" style=\"position:relative;\"><a href=\"#preserving-the-pipeline\" aria-label=\"preserving the pipeline permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Preserving the Pipeline</h3>\n<p>To preserve the pipeline and avoid copying and pasting my query, I turn to <a href=\"https://hexdocs.pm/elixir/main/Kernel.html#tap/2\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code>Kernel.tap/2</code></a>. <code>tap/2</code> will pipe its first argument as the argument to the function you pass in as the second argument. Rather than passing on the result of the function, <code>tap/2</code> returns the original value; this allows us to pipe in the query, <code>explain</code> it, and then pass it, unchanged, to our query function. Let's see what this looks like:</p>\n<pre class=\"grvsc-container tomorrow grvsc-ps-tJmpaV\" data-language=\"ex\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">def</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-10 grvsc-tJmpaV-10\">posts_with_recent_activity</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">() </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  recent </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;Etc/UTC&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">|&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">DateTime</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.now!()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">|&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">DateTime</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.add(</span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">-</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">60</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">*</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">60</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">*</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">24</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">, </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">:second</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  from(p </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">in</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Post</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">|&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> join(</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">:left</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">, [p], c </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">in</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> assoc(p, </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">:comments</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">|&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> preload([p, c], </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">comments:</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> c)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">|&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> where([p, c], p.inserted_at </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> ^recent </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">or</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">                   c.inserted_at </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> ^recent)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">|&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> order_by([p], </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">desc:</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> p.inserted_at)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">|&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> tap(</span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">fn</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> query </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">-&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">SampleBlog</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Repo</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">|&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Ecto</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Adapters</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">SQL</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.explain(</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">:all</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">, query)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">|&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">IO</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.puts()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">end</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">|&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Repo</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.all()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">end</span></span></span></code></pre>\n<p>Now, we will continue to receive the actual response from our query and have our <code>EXPLAIN</code> statement logged as well.</p>\n<pre class=\"grvsc-container tomorrow grvsc-ps-tJmpaV\" data-language=\"ex\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Blog</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.posts_with_recent_activity()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">|&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">IO</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.inspect(</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">label:</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;Result&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">)</span></span></span></code></pre>\n<pre class=\"grvsc-container tomorrow grvsc-ps-tJmpaV\" data-language=\"sql\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-3 grvsc-tJmpaV-3\">-- explain statement</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">Sort  (cost</span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">56</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">17</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">..</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">57</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">39</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">rows</span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">489</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> width</span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">604</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  Sort </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">Key</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">: </span><span class=\"grvsc-t564vY-5 grvsc-tJmpaV-5\">b0</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-5 grvsc-tJmpaV-5\">inserted_at</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">DESC</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">-&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">Hash</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">Right Join</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  (cost</span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">13</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">15</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">..</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">34</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">32</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">rows</span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">489</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> width</span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">604</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">        </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">Hash</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> Cond: (</span><span class=\"grvsc-t564vY-5 grvsc-tJmpaV-5\">b1</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-5 grvsc-tJmpaV-5\">post_id</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-5 grvsc-tJmpaV-5\">b0</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-5 grvsc-tJmpaV-5\">id</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">        </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">Filter</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">: ((</span><span class=\"grvsc-t564vY-5 grvsc-tJmpaV-5\">b0</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-5 grvsc-tJmpaV-5\">inserted_at</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&#39;2021-12-29 20:54:38&#39;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">::</span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">timestamp</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">without</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">time</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">zone</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">) </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">OR</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> (</span><span class=\"grvsc-t564vY-5 grvsc-tJmpaV-5\">b1</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-5 grvsc-tJmpaV-5\">inserted_at</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&#39;2021-12-29 20:54:38&#39;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">::</span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">timestamp</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">without</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">time</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">zone</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">        </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">-&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  Seq Scan </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">on</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> blog_comments b1  (cost</span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">0</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">00</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">..</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">18</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">80</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">rows</span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">880</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> width</span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">64</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">        </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">-&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">Hash</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  (cost</span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">11</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">40</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">..</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">11</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">40</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">rows</span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">140</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> width</span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">540</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">              </span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">-&gt;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  Seq Scan </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">on</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> blog_posts b0  (cost</span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">0</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">00</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">..</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">11</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">40</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-11 grvsc-tJmpaV-11\">rows</span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">140</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> width</span><span class=\"grvsc-t564vY-6 grvsc-tJmpaV-6\">=</span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">540</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">)</span></span></span></code></pre>\n<pre class=\"grvsc-container tomorrow grvsc-ps-tJmpaV\" data-language=\"elixir\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-3 grvsc-tJmpaV-3\"># IO.inspect</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">Result:</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> [</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  %</span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">SampleBlog</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Blog</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Post</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">__meta__:</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-3 grvsc-tJmpaV-3\">#Ecto.Schema.Metadata&lt;:loaded, &quot;blog_posts&quot;&gt;,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">comments:</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> [</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">      %</span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">SampleBlog</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Blog</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">.</span><span class=\"grvsc-t564vY-8 grvsc-tJmpaV-8\">Comment</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">        </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">__meta__:</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-3 grvsc-tJmpaV-3\">#Ecto.Schema.Metadata&lt;:loaded, &quot;blog_comments&quot;&gt;,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">        </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">body:</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;First!&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">        </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">id:</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">31</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">        </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">inserted_at:</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">~N[2021-12-30 20:54:38]</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">        </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">post:</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-3 grvsc-tJmpaV-3\">#Ecto.Association.NotLoaded&lt;association :post is not loaded&gt;,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">        </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">post_id:</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">36</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">        </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">updated_at:</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">~N[2021-12-30 20:54:38]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">      }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    ],</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">id:</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">36</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">inserted_at:</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">~N[2021-12-30 20:54:38]</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">title:</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">&quot;My first post&quot;</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">    </span><span class=\"grvsc-t564vY-4 grvsc-tJmpaV-4\">updated_at:</span><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\"> </span><span class=\"grvsc-t564vY-7 grvsc-tJmpaV-7\">~N[2021-12-30 20:54:38]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-t564vY-1 grvsc-tJmpaV-1\">]</span></span></span></code></pre>\n<p>The <a href=\"/2021/09/intro-to-postgres-explain/#caveats\">caveats of <code>EXPLAIN</code></a> aside, I have this to be a helpful tool when tuning a query. Thanks to the <code>tap</code> function, I can continue to confirm the results of my query are correct while printing out the query plan along the way.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .tomorrow {\n    background-color: #FFFFFF;\n    color: #4D4D4C;\n  }\n  .tomorrow .grvsc-t564vY-1 { color: #4D4D4C; }\n  .tomorrow .grvsc-t564vY-6 { color: #3E999F; }\n  .tomorrow .grvsc-t564vY-8 { color: #C82829; }\n  .tomorrow .grvsc-t564vY-4 { color: #F5871F; }\n  .tomorrow .grvsc-t564vY-11 { color: #8959A8; }\n  .tomorrow .grvsc-t564vY-10 { color: #4271AE; }\n  .tomorrow .grvsc-t564vY-7 { color: #718C00; }\n  .tomorrow .grvsc-t564vY-3 { color: #8E908C; }\n  .tomorrow .grvsc-t564vY-5 { color: #666969; }\n  .tomorrow .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(0, 0, 0, 0.05));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(0, 0, 0, 0.2));\n  }\n  body.dark .grvsc-ps-tJmpaV {\n    background-color: #1D1F21;\n    color: #C5C8C6;\n  }\n  body.dark .grvsc-ps-tJmpaV .grvsc-tJmpaV-1 { color: #C5C8C6; }\n  body.dark .grvsc-ps-tJmpaV .grvsc-tJmpaV-6 { color: #8ABEB7; }\n  body.dark .grvsc-ps-tJmpaV .grvsc-tJmpaV-8 { color: #CC6666; }\n  body.dark .grvsc-ps-tJmpaV .grvsc-tJmpaV-4 { color: #DE935F; }\n  body.dark .grvsc-ps-tJmpaV .grvsc-tJmpaV-11 { color: #B294BB; }\n  body.dark .grvsc-ps-tJmpaV .grvsc-tJmpaV-10 { color: #81A2BE; }\n  body.dark .grvsc-ps-tJmpaV .grvsc-tJmpaV-7 { color: #B5BD68; }\n  body.dark .grvsc-ps-tJmpaV .grvsc-tJmpaV-3 { color: #969896; }\n  body.dark .grvsc-ps-tJmpaV .grvsc-tJmpaV-5 { color: #CED1CF; }\n  body.dark .grvsc-ps-tJmpaV .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","frontmatter":{"title":"EXPLAIN Query with Ecto","date":"March 31, 2022"}}},"pageContext":{"slug":"/2022/03/ecto-explain/","previous":{"fields":{"slug":"/2022/02/taking-breaks/"},"frontmatter":{"title":"Taking Breaks"}},"next":{"fields":{"slug":"/2022/04/open-source-open-eyes/"},"frontmatter":{"title":"Open Source Opening My Eyes"}}}},"staticQueryHashes":["3128451518","3649515864"]}